<!doctype html>
<html>
    <head>
        <title>Mundos Stone Optimizer</title>
        <link rel="stylesheet" type="text/css" href="/stylesheets/basic-grey.css"/>
        <link rel="stylesheet" type="text/css" href="/stylesheets/styles.css"/>
    </head>
    <body onload='hideResult()'>
        <center>
            <form action="" method="post" class="basic-grey" id="mundosform" onSubmit="return optimizeMundosStone()">
                <h1>Mundos Stone Optimizer
                    <span>Which Mundos Stone should I use?</span>
                </h1>
                <label>
                    <span>Magicka :</span>
                    <input id="magicka" type="text" name="magicka" placeholder="40000"/>
                </label>
                <label>
                    <span>Spell Damage :</span>
                    <input id="spelldamage" type="text" name="spelldamage" placeholder="3000"/>
                </label>
                <label>
                    <span>Crit Chance (%):</span>
                    <input id="critchance" type="text" name="critchance" placeholder="50"/>
                </label>
                <label>
                    <span>Crit Damage (%):</span>
                    <input id="critdamage" type="text" name="critdamage" placeholder="50"/>
                </label>
                <label>
                    <span>&nbsp;</span>
                    <input type="button" class="button" value="Optimize" />
                </label>
            </form>

            <div id="result">
                You should use <b>The <span id="beststone"></span></b>
            </div>
        </center>

        <script>
            var mageBonus = 1280;
            var apprenticeBonus = 166;
            var thiefBonus = 0.11;
            var shadowBonus = 0.12;

            var spellDamageCoef = 10.46;

            function optimizeMundosStone() {
                var mundosForm = document.form["mundosform"];
                var bestStone = "";

                var magicka = parseInt(mundosForm.elements["magicka"]);
                var spellDamage = parseInt(mundosForm.elements["spelldamage"]);
                var critChance = parseInt(mundosForm.elements["critchance"]) / 100.0;
                var critDamage = parseInt(mundosForm.elements["critdamage"]) / 100.0;

                var deltaMage = mageBonus * (1 + critDamage * critChance);
                var deltaApprentice = spellDamageCoef * apprenticeBonus * (1 + critDamage * critChance);
                var deltaThief = (magicka + spellDamageCoef * spellDamage) * (critDamage * thiefBonus);
                var deltaShadow = (magicka + spellDamageCoef * spellDamage) * (shadowBonus * critChance);

                if (deltaMage > deltaApprentice
                        && deltaMage > deltaThief
                        && deltaMage > deltaShadow)
                    bestStone = "Mage";
                else if (deltaApprentice > deltaThief
                        && deltaApprentice > deltaShadow)
                    bestStone = "Apprentice";
                else if (deltaThief > deltaShadow)
                    bestStone = "Thief";
                else
                    bestStone = "Shadow";

                var spanObj = document.getElementById('beststone');
                spanObj.innerHTML = bestStone;
                showResult();
            }

            function showResult() {
                var divObj = document.getElementById('result');
                divObj.style.display='block';
            }

            function hideResult() {
                var divObj = document.getElementById('result');
                divObj.style.display='none';
            }
        </script>
    </body>
</html>
